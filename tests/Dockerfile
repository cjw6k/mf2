ARG PHP_VERSION="8.1-buster"

FROM php:${PHP_VERSION} as phpize

RUN apt-get update && apt-get install -y \
    libxml2-dev \
 && rm -rf /var/lib/apt/lists/*

WORKDIR /usr/share/microformats
COPY . .

RUN phpize \
 && EXTRA_CFLAGS='-Wall -Wextra -Wno-unused-parameter' \
    ./configure \
      --with-libxml \
 && make -j2 \
 && make install

RUN docker-php-ext-enable mf2

ENV REPORT_EXIT_STATUS=1

CMD ["php", "./run-tests.php", "-P", "-q", "--show-diff"]